---
import invariant from "tiny-invariant";
import { keystatic } from "@lib/keystatic/client";
import { Icon } from "astro-icon/components";
import Link from "./Link.astro";
import KeystaticImage from "./KeystaticImage.astro";
import EndCta from "./EndCta.astro";

const i18n = await keystatic.singletons.footer.read({
  resolveLinkedFiles: true,
});

const homepageI18n = await keystatic.singletons.homepage.read({
  resolveLinkedFiles: true,
});
const cta = homepageI18n?.cta;

invariant(i18n, "No footer content found");

const socialIconMap = {
  github: { icon: "bi:github", label: "Visit our GitHub profile" },
  twitter: { icon: "bi:twitter-x", label: "Follow us on X (Twitter)" },
  twitch: { icon: "bi:linkedin", label: "Connect with us on LinkedIn" },
  youtube: { icon: "bi:youtube", label: "Subscribe to our YouTube channel" },
  discord: { icon: "bi:discord", label: "Join our Discord server" },
} as const;
---

<EndCta cta={cta} />
<div class="font-display border-t-5 border-black bg-white">
  <footer class="px-base pt-[80px] pb-[140px] sm:pt-[100px] sm:pb-[200px]">
    <div class="container-content">
      <div class="flex flex-col justify-between gap-12 sm:flex-row sm:gap-10">
        <div class="flex w-[240px] flex-col items-start gap-10">
          <KeystaticImage
            src={i18n.logo.image}
            alt={i18n.logo.alt}
            class="h-[50px]"
          />

          <p class="t-xs">
            {i18n.tagline}
          </p>

          <div class="flex items-center gap-[30px]">
            {
              i18n.socialMedia.map((social) => {
                const iconData =
                  socialIconMap[social.platform as keyof typeof socialIconMap];
                if (!iconData) return null;

                return (
                  <a
                    href={social.url}
                    target="_blank"
                    class="underline-offset-4 hover:underline"
                    rel="noopener noreferrer"
                    aria-label={iconData.label}
                  >
                    <Icon name={iconData.icon} class="h-6 w-6" />
                  </a>
                );
              })
            }
            <a
              href="/rss.xml"
              class="underline-offset-4 hover:underline"
              aria-label="Subscribe to our RSS feed"
            >
              <Icon name="simple-icons:rss" class="h-6 w-6" />
            </a>
          </div>
        </div>
        <div class="flex w-[240px] flex-col gap-10">
          <p class="lg:text-h4 lg:leading-h4 text-h5 leading-h5 font-bold">
            Contact
          </p>
          <div class="flex flex-col gap-5">
            <Link href={`mailto:${i18n.contact.email}`} class="t-xs">
              {i18n.contact.email}
            </Link>
            {
              i18n.contact.phone && (
                <Link href={`tel:${i18n.contact.phone}`} class="t-xs">
                  {i18n.contact.phone}
                </Link>
              )
            }
            <p class="t-xs !w-full">
              {i18n.contact.address}
            </p>
          </div>
        </div>
      </div>

      <div class="container-content mt-12! border-t pt-8">
        <div
          class="flex flex-col items-center justify-between gap-4 sm:flex-row"
        >
          {
            i18n.bottomLinks && i18n.bottomLinks.length > 0 && (
              <div class="flex flex-wrap gap-6">
                {i18n.bottomLinks.map((link) => (
                  <Link href={link.href} class="t-xs">
                    {link.label}
                  </Link>
                ))}
              </div>
            )
          }

          {i18n.copyright && <p class="t-xs">{i18n.copyright}</p>}
        </div>
      </div>
    </div>
  </footer>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="w-full"
    viewBox="0 0 1440 168"
    fill="none"
  >
    <g clip-path="url(#clip0_391_1410)">
      <rect width="1440" height="168" fill="white"></rect>
      <path
        d="M169.059 28.1416L197.235 28.1426V112.57H140.883V28.1426H56.3525V112.572H169.059V140.715H56.3525V197H0V0H169.059V28.1416Z"
        fill="black"></path>
      <path
        d="M310.588 197H254.235V56.2861H310.588V197ZM451.471 197H395.118V140.714H310.589V112.571H395.118V56.2861H451.471V197ZM395.118 28.1426H423.294V56.2852H366.941V28.1426H338.765V56.2852H282.412V28.1426H310.589V0H395.118V28.1426Z"
        fill="black"></path>
      <path
        d="M677.529 0V28.1426H621.177V197H564.823V28.1426H508.471V0H677.529Z"
        fill="black"></path>
      <path
        d="M931.765 197H847.236V168.857H931.765V197ZM903.588 28.1426H931.765V112.57H875.412V28.1426H790.882V112.571H847.236V84.4287H875.411V140.714H903.588V168.856H819.059V140.714H790.882V196.999H734.53V0H903.588V28.1426Z"
        fill="black"></path>
      <path
        d="M1157.82 197H1016.94V168.857H1157.82V197ZM1186 168.855H1129.65V28.1426H1045.12V168.855H988.765V28.1426H1016.94V0H1157.82V28.1426H1186V168.855Z"
        fill="black"></path>
      <path
        d="M1299.35 197H1243V0H1299.35V197ZM1440.24 197H1383.88V0H1440.24V197ZM1355.71 84.4287H1383.88V140.714H1355.71V112.572H1327.53V56.2861H1355.71V84.4287ZM1327.53 84.4277H1299.35V28.1426H1327.53V84.4277Z"
        fill="black"></path>
    </g>
    <defs>
      <clipPath id="clip0_391_1410">
        <rect width="1440" height="168" fill="white"></rect>
      </clipPath>
    </defs>
  </svg>
</div>
